<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSgB Pharmacy Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --maroon:#6b0f0f;
            --maroon-dark:#520b0b;
            --white: #ffffff;
            --light-grey: #f5f5f5;
            --dark-grey: #a9a9a9;
            --light-bg: #f9f9f9;
            --box-bg: #f0f0f0;
            --border-color: #ccc;
        }

        * {
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--light-grey);
            color: #333;
        }

        .header {
            background-color: var(--maroon);
            color: var(--white);
            padding: 22px 25px;
            display: flex;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            cursor: pointer;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .header-content .logo {
            font-weight: 700;
            font-size: 1.8em;
            margin-right: 20px;
            color: var(--white);
            background-color: #7E2C2C;
            padding: 5px 8px;
            border-radius: 8px;
        }

        .header-text {
            display: flex;
            flex-direction: column;
        }

        .header-text h1 {
            margin: 0;
            font-size: 1.5em;
            font-weight: 600;
            color: var(--white);
        }

        .header-text p {
            margin: 0;
            font-size: 0.8em;
            font-weight: 400;
            color: var(--white);
            opacity: 0.8;
        }
        
        .navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            padding-top: 12px;
        }

        .nav-button {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            background-color: var(--light-grey);
            color: var(--maroon);
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .nav-button:hover {
            background-color: var(--dark-grey);
            color: var(--white);
        }

        .nav-button-home {
            background-color: var(--maroon);
            color: var(--white);
            font-weight: 600;
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .nav-button-home:hover {
            background-color: #6a0000;
        }

        .page {
            display: none;
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            max-width: 900px;
            margin: 20px auto;
            padding: 8px 20px 20px 20px;
        }
        
        .page.active {
            display: block;
        }

        @media (max-width: 960px) {
            .page {
                    max-width: 90%; /* Responsive width for smaller screens */
            }
        }

        h2 {
            font-size: 1.6em;
            font-weight: 600;
            color: var(--maroon);
            border-bottom: 2px solid var(--light-grey);
            padding-bottom: 10px;
            margin-top: 20px;
        }

        h3 {
            font-size: 1.2em;
            font-weight: 500;
            color: var(--maroon);
            margin-top: 20px;
        }
        
        .calculator-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .calculator-card {
                background: linear-gradient(to bottom, #F4F4F4, var(--white));
                border-radius: 15px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                padding: 8px 20px;
                cursor: pointer;
                transition: transform 0.2s, box-shadow 0.2s;
                box-sizing: border-box;
                border: 1px solid #c0c0c0;
                border-left: 8px solid var(--maroon);
        }
        
        .calculator-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .card-title {
            font-weight: 600;
            color: var(--maroon);
            font-size: 1.2em;
        }
        
        .card-footnote {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        input[type="number"], select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1em;
            background-color: var(--light-bg);
        }

        .output-box {
            background-color: #e6e6e6;
            border: 2px solid var(--maroon);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }

        .output-box-cream {
            background-color: #fff8e1;
            border: 2px solid var(--maroon);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }

        .output-title {
            font-weight: 600;
            color: var(--maroon);
            font-size: 1.1em;
        }
        
        .output-value {
            font-weight: 700;
            font-size: 1.6em;
            color: var(--maroon);
            margin-top: 5px;
        }
        
        .sub-output-card {
            background-color: var(--white);
            border: 1px solid #c0c0c0;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }
        
        .sub-output-title {
            font-weight: 500;
            font-size: 0.9em;
            color: #333;
        }
        
        .sub-output-value {
            font-weight: 600;
            font-size: 1.1em;
            color: var(--maroon);
        }

        .footnote {
            font-size: 0.8em;
            color: #888;
            margin-top: 5px;
        }

        .footer-link {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-style: italic;
            font-size: 0.9em;
            color: #C14F4F;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid var;
        }

        .footer-link a {
            color: inherit; /* Inherits the color from the parent .footer-link */
            text-decoration: none; /* Removes the default underline */
        }
        
        .shaded-box {
            background-color: var(--box-bg);
            border-radius: 8px;
            padding: 10px;
            margin: 15px 0;
            font-size: 0.9em;
            color: #555;
        }
        
        .shaded-box-pink {
            background-color: #fcebeb;
            border-radius: 8px;
            padding: 10px;
            margin: 15px 0;
            font-size: 0.9em;
            color: #555;
            border-left: 4px solid var(--maroon);
            box-sizing: border-box;
        }

        .disclaimer-section {
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);           
            padding: 20px;
            font-size: 0.8em;
            color: #666;
            max-width: 90%;
            margin: 20px auto;
        }

        .disclaimer-section p {
            margin: 5px 0;
        }

        .disclaimer-section p.bold {
            font-weight: 600;
        }
        
        .enoxaparin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: var(--white);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 0.9em;
        }

        .enoxaparin-table th, .enoxaparin-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .enoxaparin-table th {
            background-color: var(--maroon);
            color: var(--white);
            font-weight: 600;
        }

        .enoxaparin-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .enoxaparin-table tr:hover {
            background-color: #e9e9e9;
        }
        
        .enoxaparin-table td.highlight {
            font-weight: 700;
            background-color: #fff8e1;
            border: 2px solid var(--maroon);
        }

        .footer-formula {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid var(--light-grey);
            border-radius: 8px;
            font-size: 0.8em;
            color: #555;
            background-color: var(--light-grey);
        }
    </style>
</head>
<body>

<div class="header" onclick="showPage('page1')">
    <div class="header-content">
        <div class="logo">HSgB</div>
        <div class="header-text">
            <h1>Hospital Sungai Buloh Pharmacy Calculator</h1>
            <p>Quick dosing & weight calculators for hospital staff</p>
        </div>
    </div>
</div>

    
    <div id="page1" class="page active">
        <h2>Available Calculators</h2>
        <p class="subtitle">Select a calculator below. The title/header is clickable to return here.</p>
        <div class="calculator-list">
            <div class="calculator-card" onclick="showPage('page2')">
                <p class="card-title">Iron Dextran (Cosmofer) Dose Calculator</p>
                <p class="card-footnote">Calculate total iron dose and final dosing recommendation</p>
            </div>
            <div class="calculator-card" onclick="showPage('page3')">
                <p class="card-title">Body Weight (BW) Calculator</p>
                <p class="card-footnote">BMI, BSA, IBW (Devine) & Adjusted BW</p>
            </div>
            <div class="calculator-card" onclick="showPage('page4')">
                <p class="card-title">Renal Function (CrCl) Calculator</p>
                <p class="card-footnote">Cockcroft-Gault-based creatinine clearance</p>
            </div>
            <div class="calculator-card" onclick="showPage('page5')">
                <p class="card-title">Enoxaparin (Clexane) Dose Calculator</p>
                <p class="card-footnote">Dose guide per indication and weight bands with renal adjustment</p>
            </div>
            <div class="calculator-card" onclick="showPage('page6')">
                <p class="card-title">Vassopressor & Inotrope Supply Calculator</p>
                <p class="card-footnote">Calculate number of ampoules to supply based on drug strength and infusion rate</p>
            </div>
        </div>
    </div>

    <div id="page2" class="page">
        <div class="navigation" id="nav-buttons-page2">
            <button class="nav-button-home" onclick="showPage('page1')">HOME</button>
            <button class="nav-button" onclick="clearForm()">CLEAR</button>
        </div>
        <h2>Iron Dextran (Cosmofer) Dose Calculator</h2>
        <div class="form-group">
            <label for="cosmofer-indication">Indication</label>
            <select id="cosmofer-indication" onchange="calculateCosmofer()">
                <option value="">Select an Indication</option>
                <option value="blood-loss">Blood loss, Eg: During labour</option>
                <option value="ida">Iron Deficiency Anaemia (IDA)</option>
            </select>
            <p id="cosmofer-ida-footnote" class="footnote" style="display:none;">Additional dose: 500 mg</p>
        </div>
        <div class="form-group">
            <label for="cosmofer-bw">Body Weight (kg)</label>
            <input type="number" id="cosmofer-bw" oninput="calculateCosmofer()">
            <div class="shaded-box-pink" style="font-size:0.8em;">
                i) In pregnancy, use pre-pregnancy body weight.<br>
                ii) In obese patients (BMI &gt; 30kg/m2), use <a href="#" onclick="showPage('page3')">Ideal Body Weight (IBW)</a>.
            </div>
        </div>
        <div class="form-group">
            <label for="cosmofer-target-hb">Target Hb (g/dL)</label>
            <input type="number" id="cosmofer-target-hb" oninput="calculateCosmofer()">
        </div>
        <div class="form-group">
            <label for="cosmofer-current-hb">Current Hb (g/dL)</label>
            <input type="number" id="cosmofer-current-hb" oninput="calculateCosmofer()">
        </div>

        <div id="cosmofer-outputs" style="display:none;">
            <h3>Results</h3>
            <div class="sub-output-card">
                <div class="sub-output-title">Calculated dose (mg)</div>
                <div class="sub-output-value" id="cosmofer-calculated-dose"></div>
                <p id="cosmofer-calculated-footnote" class="footnote"></p>
            </div>

            <div class="output-box-cream">
                <div class="output-title">Final Dose of Cosmofer (Test Dose Included)</div>
                <div class="output-value" id="cosmofer-final-dose"></div>
                <p class="footnote">*Dose rounded to the nearest 100 mg</p>
            </div>

            <div class="sub-output-card">
                <div class="sub-output-title">Dose per Body Weight (mg/kg)</div>
                <div class="sub-output-value" id="cosmofer-dose-per-bw"></div>
            </div>

            <div class="sub-output-card">
                <div class="sub-output-title">Remarks</div>
                <div class="sub-output-value" id="cosmofer-remarks"></div>
            </div>
        </div>
        
        <p class="footer-link"><a href="https://drive.google.com/file/d/1EjZOkMmgV2bRYdxenEfAlQm6cX5qI9RE/view?usp=sharing" target="_blank">ðŸ”— Refer to PRIC Newsletter (Cosmofer Quick Guide)</a></p>
        <p class="footer-formula">Formula: Calculated dose (mg) = Body Weight (kg) x (Target Hb - Current Hb) x 2.4<br>Note: For IDA, 500 mg has been added to the calculated dose.</p>
    </div>

    <div id="page3" class="page">
        <div class="navigation" id="nav-buttons-page3">
            <button class="nav-button-home" onclick="showPage('page1')">HOME</button>
            <button class="nav-button" onclick="clearForm()">CLEAR</button>
        </div>
        <h2>Body Weight (BW) Calculator</h2>
        <div class="form-group">
            <label for="bw-actual-weight">Actual Body Weight (kg)</label>
            <input type="number" id="bw-actual-weight" oninput="calculateBodyWeight()">
        </div>
        <div class="form-group">
            <label for="bw-height">Height (cm)</label>
            <input type="number" id="bw-height" oninput="calculateBodyWeight()">
        </div>
        <div class="form-group">
            <label for="bw-gender">Gender</label>
            <select id="bw-gender" onchange="calculateBodyWeight()">
                <option value="">Select Gender</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
            </select>
            <p class="footnote">*Optional, required only for Ideal Body Weight & Adjusted Body Weight calculation.</p>
        </div>

        <div id="bw-outputs" style="display:none;">
            <h3>Results</h3>
            <div class="output-box">
                <div class="output-title">Body Mass Index (BMI)</div>
                <div class="output-value" id="bw-bmi"></div>
            </div>
            <div class="output-box">
                <div class="output-title">Body Surface Area (BSA)</div>
                <div class="output-value" id="bw-bsa"></div>
            </div>
            <div class="output-box">
                <div class="output-title">Ideal Body Weight (IBW)</div>
                <div class="output-value" id="bw-ibw"></div>
            </div>
            <div class="output-box">
                <div class="output-title">Adjusted Body Weight (AdjBW)</div>
                <div class="output-value" id="bw-adjbw"></div>
            </div>
        </div>

        <p class="footer-formula">
            <b>BMI:</b> Body Weight (kg) / (Height (m) x Height (m))<br>
            <b>BSA:</b> &radic;((Height (cm) x Weight (kg)) / 3600)<br>
            <b>IBW (Devine):</b> Male: 50kg + 0.9kg x (Height (cm) - 152cm); Female: 45.5kg + 0.9kg x (Height (cm) - 152cm)<br>
            <b>AdjBW:</b> IBW + 0.4 x (Actual Weight - IBW). Shown only when Actual > IBW.
        </p>
    </div>

    <div id="page4" class="page">
        <div class="navigation" id="nav-buttons-page4">
            <button class="nav-button-home" onclick="showPage('page1')">HOME</button>
            <button class="nav-button" onclick="clearForm()">CLEAR</button>
        </div>
        <h2>Renal Function Calculator (CrCl)</h2>
        <div class="form-group">
            <label for="crcl-age">Age (years old)</label>
            <input type="number" id="crcl-age" oninput="calculateCrCl()">
        </div>
        <div class="form-group">
            <label for="crcl-bw">Body Weight (kg)</label>
            <input type="number" id="crcl-bw" oninput="calculateCrCl()">
            <div class="shaded-box-pink" style="font-size:0.8em;">
                For obese patients, use <a href="#" onclick="showPage('page3')">Adjusted Body Weight (AdjBW)</a>.
            </div>
        </div>
        <div class="form-group">
            <label for="crcl-gender">Gender</label>
            <select id="crcl-gender" onchange="calculateCrCl()">
                <option value="">Select Gender</option>
                <option value="male">Male</option>
                <option value="female">Female</option>
            </select>
        </div>
        <div class="form-group">
            <label for="crcl-scr">Serum Creatinine (SCr) (Î¼mol/L)</label>
            <input type="number" id="crcl-scr" oninput="calculateCrCl()">
        </div>

        <div id="crcl-outputs" style="display:none;">
            <h3>Results</h3>
            <div class="output-box-cream">
                <div class="output-title">Creatinine Clearance (CrCl)</div>
                <div class="output-value" id="crcl-result"></div>
            </div>
        </div>

        <p class="footer-formula">
            Formula: (140 - Age) x Body Weight x F / Serum creatinine (Î¼mol/L) <br>
            *F = 1.23 for males, 1.04 for females.<br>
            *Formula from the Cockcroft-Gault equation.
        </p>
    </div>
    
    <div id="page5" class="page">
        <div class="navigation" id="nav-buttons-page5">
            <button class="nav-button-home" onclick="showPage('page1')">HOME</button>
            <button class="nav-button" onclick="clearForm()">CLEAR</button>
        </div>
        <h2>Enoxaparin (Clexane) Dose Calculator</h2>
        <div class="form-group">
            <label for="enox-indication">Indication</label>
            <select id="enox-indication" onchange="updateEnoxaparinUI()">
                <option value="">Select an Indication</option>
                <option value="pregnant-prophylaxis">Thromboprophylaxis for Pregnant Women</option>
                <option value="vte-prophylaxis">VTE Prophylaxis in Medical or Non-major Orthopaedic Surgery Patients</option>
                <option value="major-ortho-prophylaxis">VTE Prophylaxis in Major Orthopaedic Surgery (THA, TKA, Hip Fracture)</option>
                <option value="dvt-pe-treatment">DVT or PE Treatment</option>
                <option value="acs-treatment">ACS Treatment</option>
            </select>
            <p id="enox-treatment-footnote" class="footnote" style="display:none;">S/C Clexane Dose: 1 mg/kg BD</p>
        </div>
        <div class="form-group">
            <label for="enox-bw">Body Weight (kg)</label>
            <input type="number" id="enox-bw" oninput="updateEnoxaparinUI()">
            <p id="enox-weight-range-footnote" class="footnote"></p>
        </div>
        <div id="enoxaparin-output" style="display:none;">
            <p style="margin-top: 20px;">For a body weight of <b id="enox-bw-display"></b> kg, the recommended dosage is:</p>
            <table class="enoxaparin-table">
                <thead>
                    <tr>
                        <th>Weight</th>
                        <th>Normal Renal Function</th>
                        <th>Renal Adjusted Dose (CrCl 15â€“30 ml/min)</th>
                    </tr>
                </thead>
                <tbody id="enoxaparin-table-body">
                </tbody>
            </table>
        </div>
    </div>
    
    <div id="page6" class="page">
        <div class="navigation" id="nav-buttons-page6">
            <button class="nav-button-home" onclick="showPage('page1')">HOME</button>
            <button class="nav-button" onclick="clearForm()">CLEAR</button>
        </div>
        <h2>Vassopressor & Inotrope Supply Calculator</h2>
        <div class="form-group">
            <label for="vaso-drug">Drug Name</label>
            <select id="vaso-drug" onchange="updateVasoUI()">
                <option value="">Select a Drug</option>
                <option value="noradrenaline">Noradrenaline (NA)</option>
                <option value="dopamine">Dopamine</option>
                <option value="dobutamine">Dobutamine</option>
                <option value="adrenaline">Adrenaline (Epinephrine)</option>
            </select>
            <p id="vaso-strength-footnote" class="footnote"></p>
        </div>
        <div class="form-group">
            <label for="vaso-rate">Infusion Rate (mL/hour)</label>
            <input type="number" id="vaso-rate" oninput="calculateVasoSupply()">
        </div>
        <div class="form-group">
            <label for="vaso-strength-prep">Strength of preparation</label>
            <select id="vaso-strength-prep" onchange="calculateVasoSupply()">
                <option value="">Select Strength</option>
                <option value="single">Single strength (SS)</option>
                <option value="double">Double strength (DS)</option>
            </select>
        </div>
        <div class="form-group">
            <label for="vaso-duration">Duration (hours)</label>
            <input type="number" id="vaso-duration" value="24" oninput="calculateVasoSupply()">
            <p class="footnote">Adjust if necessary</p>
        </div>
        <div class="form-group">
            <label for="vaso-diluent">Volume of diluents per preparation (mL)</label>
            <input type="number" id="vaso-diluent" value="50" oninput="calculateVasoSupply()">
            <p class="footnote">Adjust if necessary</p>
        </div>
        
        <div id="vaso-outputs" style="display:none;">
            <h3>Results</h3>
            <div class="sub-output-card">
                <div class="sub-output-title">Summary of Input</div>
                <div class="sub-output-value" id="vaso-summary"></div>
            </div>
            <div class="sub-output-card">
                <div class="sub-output-title">Preparation</div>
                <div class="sub-output-value" id="vaso-preparation"></div>
            </div>
            <div class="output-box-cream">
                <div class="output-title">Quantity to supply:</div>
                <div class="output-value" id="vaso-quantity"></div>
            </div>
        </div>

        <p class="footer-formula">
            <b>Quantity to supply:</b> (Infusion rate (mL/hour) x Duration (hours) x Strength of preparation) / Volume of diluents (mL)<br>
            *Strength of preparation is 1 for SS, 2 for DS.
        </p>
    </div>

    <div class="disclaimer-section">
        <p>Prepared by: Izyana Munirah Idham (AMS Pharmacist), Hospital Sungai Buloh.</p>
        <p>Updated: September 2025.</p>
        <p class="bold">For Hosp Sungai Buloh Staff Use Only.</p>
        <p class="footnote">
            This guide/calculator provides general advice based on published evidence and expert opinion for standardisation of practice in HSgB. This guide may not cover all aspects of clinical practice, thus healthcare practitioners are encouraged to review patient details and professionally assess the relevance of this guide to each clinical situation. This guide is subject to periodic updates. We assume no responsibility for any party that referred to an outdated version.
        </p>
    </div>


<script>
    const pages = ['page1', 'page2', 'page3', 'page4', 'page5', 'page6'];

    function showPage(pageId) {
        pages.forEach(id => {
            document.getElementById(id).classList.remove('active');
        });
        document.getElementById(pageId).classList.add('active');
       
        
        window.scrollTo(0, 0);
    }
    
    function clearForm() {
        const activePage = document.querySelector('.page.active');
        const inputs = activePage.querySelectorAll('input, select');
        inputs.forEach(input => {
            if (input.type === 'number') {
                input.value = '';
            } else if (input.tagName === 'SELECT') {
                input.value = '';
            }
        });
        // Hide outputs on clear
        const outputs = activePage.querySelectorAll('[id$="-outputs"]');
        outputs.forEach(output => {
            output.style.display = 'none';
        });
        const enoxOutput = document.getElementById('enoxaparin-output');
        if (enoxOutput) {
            enoxOutput.style.display = 'none';
        }
        updateEnoxaparinUI();
        updateVasoUI();
    }
    
    function calculateCosmofer() {
        const indication = document.getElementById('cosmofer-indication').value;
        const bw = parseFloat(document.getElementById('cosmofer-bw').value);
        const targetHb = parseFloat(document.getElementById('cosmofer-target-hb').value);
        const currentHb = parseFloat(document.getElementById('cosmofer-current-hb').value);

        const idaFootnote = document.getElementById('cosmofer-ida-footnote');
        idaFootnote.style.display = indication === 'ida' ? 'block' : 'none';

        const outputs = document.getElementById('cosmofer-outputs');
        if (isNaN(bw) || isNaN(targetHb) || isNaN(currentHb) || !indication) {
            outputs.style.display = 'none';
            return;
        }

        outputs.style.display = 'block';

        let calculatedDose = bw * (targetHb - currentHb) * 2.4;
        let finalDose = calculatedDose;
        
        let calculatedFootnote = '';
        if (indication === 'ida') {
            finalDose += 500;
            calculatedFootnote = 'additional dose 500 mg will be added for IDA';
        }
        
        document.getElementById('cosmofer-calculated-dose').innerText = `${calculatedDose.toFixed(2)} mg`;
        document.getElementById('cosmofer-calculated-footnote').innerText = calculatedFootnote;

        const roundedDose = Math.ceil(finalDose / 100) * 100;
        document.getElementById('cosmofer-final-dose').innerText = `${roundedDose} mg`;

        const dosePerBw = roundedDose / bw;
        document.getElementById('cosmofer-dose-per-bw').innerText = `${dosePerBw.toFixed(2)} mg/kg`;

        let remarks = '';
        if (dosePerBw <= 20) {
            remarks = 'Dose is â‰¤ 20 mg/kg - may be administered as a single dose';
        } else {
            remarks = 'Dose is > 20 mg/kg, suggest to administer 20 mg/kg in the 1st infusion, then the remainder in the 2nd infusion';
        }
        document.getElementById('cosmofer-remarks').innerText = remarks;
    }

    function calculateBodyWeight() {
        const actualWeight = parseFloat(document.getElementById('bw-actual-weight').value);
        const height = parseFloat(document.getElementById('bw-height').value);
        const gender = document.getElementById('bw-gender').value;

        const outputs = document.getElementById('bw-outputs');
        if (isNaN(actualWeight) || isNaN(height)) {
            outputs.style.display = 'none';
            return;
        }
        outputs.style.display = 'block';
        
        const heightM = height / 100;
        const bmi = actualWeight / (heightM * heightM);
        document.getElementById('bw-bmi').innerText = `${bmi.toFixed(2)} kg/mÂ²`;

        const bsa = Math.sqrt((height * actualWeight) / 3600);
        document.getElementById('bw-bsa').innerText = `${bsa.toFixed(2)} mÂ²`;
        
        let ibw = 'Not applicable';
        let adjbw = 'Not applicable';
        
        if (gender === 'male') {
            ibw = 50 + 0.9 * (height - 152);
        } else if (gender === 'female') {
            ibw = 45.5 + 0.9 * (height - 152);
        }

        if (typeof ibw === 'number') {
            document.getElementById('bw-ibw').innerText = `${ibw.toFixed(2)} kg`;
            if (actualWeight > ibw) {
                adjbw = ibw + 0.4 * (actualWeight - ibw);
                document.getElementById('bw-adjbw').innerText = `${adjbw.toFixed(2)} kg`;
            } else {
                document.getElementById('bw-adjbw').innerText = 'Not applicable';
            }
        } else {
            document.getElementById('bw-ibw').innerText = ibw;
            document.getElementById('bw-adjbw').innerText = adjbw;
        }
    }
    
    function calculateCrCl() {
        const age = parseFloat(document.getElementById('crcl-age').value);
        const bw = parseFloat(document.getElementById('crcl-bw').value);
        const gender = document.getElementById('crcl-gender').value;
        const scr = parseFloat(document.getElementById('crcl-scr').value);

        const outputs = document.getElementById('crcl-outputs');
        if (isNaN(age) || isNaN(bw) || isNaN(scr) || !gender) {
            outputs.style.display = 'none';
            return;
        }
        outputs.style.display = 'block';

        let F = 1.23;
        if (gender === 'female') {
            F = 1.04;
        }
        
        const crcl = ((140 - age) * bw * F) / scr;
        document.getElementById('crcl-result').innerText = `${crcl.toFixed(2)} ml/min`;
    }
    
    const enoxDoseData = {
        'pregnant-prophylaxis': {
            'footnote': '',
            'weightRanges': [
                { range: '<50', normal: 'S/C Enoxaparin (Clexane) 20 mg OD', renal: 'Consider 50% of the standard dose' },
                { range: '50â€“90', normal: 'S/C Enoxaparin (Clexane) 40 mg OD', renal: 'S/C Enoxaparin (Clexane) 20 mg OD' },
                { range: '91â€“130', normal: 'S/C Enoxaparin (Clexane) 60 mg OD', renal: 'S/C Enoxaparin (Clexane) 30 mg OD' },
                { range: '131â€“170', normal: 'S/C Enoxaparin (Clexane) 80 mg OD', renal: 'S/C Enoxaparin (Clexane) 40 mg OD' },
                { range: '>170', normal: 'S/C Enoxaparin (Clexane) 0.6 mg/kg/day', renal: 'Consider 50% of the standard dose' }
            ]
        },
        'vte-prophylaxis': {
            'footnote': '',
            'weightRanges': [
                { range: '<40', normal: 'No recommendation', renal: 'No recommendation' },
                { range: 'â‰¥40', normal: 'S/C Enoxaparin (Clexane) 40 mg OD', renal: 'S/C Enoxaparin (Clexane) 20 mg OD' }
            ]
        },
        'major-ortho-prophylaxis': {
            'footnote': '',
            'weightRanges': [
                { range: '<40', normal: 'No recommendation', renal: 'No recommendation' },
                { range: 'â‰¥40', normal: 'S/C Enoxaparin (Clexane) 40â€“60 mg OD', renal: 'S/C Enoxaparin (Clexane) 20â€“30 mg OD' }
            ]
        },
        'dvt-pe-treatment': {
            'footnote': 'S/C Clexane Dose: 1 mg/kg BD',
            'weightRanges': [
                { range: '<40', normal: 'S/C Enoxaparin (Clexane) 20â€“40 mg BD<br><br>Alternative option: S/C Fondaparinux (Arixtra) 5 mg OD', renal: 'Consider 50% of the standard dose' },
                { range: '40â€“49', normal: 'S/C Enoxaparin (Clexane) 40 mg BD<br><br>Alternative option: S/C Fondaparinux (Arixtra) 5 mg OD', renal: 'S/C Enoxaparin (Clexane) 40 mg OD' },
                { range: '50â€“69', normal: 'S/C Enoxaparin (Clexane) 60 mg BD<br><br>Alternative option: S/C Fondaparinux (Arixtra) 7.5 mg OD', renal: 'S/C Enoxaparin (Clexane) 60 mg OD' },
                { range: '70â€“99', normal: 'S/C Enoxaparin (Clexane) 80 mg BD<br><br>Alternative option: S/C Fondaparinux (Arixtra) 7.5 mg OD', renal: 'S/C Enoxaparin (Clexane) 80 mg OD' },
                { range: '100â€“120', normal: 'S/C Enoxaparin (Clexane) 100â€“120 mg BD<br><br>Alternative option: S/C Fondaparinux (Arixtra) 10 mg OD', renal: 'S/C Enoxaparin (Clexane) 80â€“120 mg OD' },
                { range: 'BMI â‰¥40 kg/mÂ²', normal: 'S/C Enoxaparin (Clexane) 0.75 mg/kg BD (up to 160 mg BD)<br><br>Alternative option: S/C Fondaparinux (Arixtra) 10 mg OD', renal: 'S/C Enoxaparin (Clexane) 0.75 mg/kg OD (up to 160 mg OD)' }
            ]
        },
        'acs-treatment': {
            'footnote': 'S/C Clexane Dose: 1 mg/kg BD',
            'weightRanges': [
                { range: '<40', normal: 'S/C Enoxaparin (Clexane) 20â€“40 mg BD<br><br>Alternative option: S/C Fondaparinux (Arixtra) 2.5 mg OD', renal: 'Consider 50% of the standard dose' },
                { range: '40â€“49', normal: 'S/C Enoxaparin (Clexane) 40 mg BD<br><br>Alternative option: S/C Fondaparinux (Arixtra) 2.5 mg OD', renal: 'S/C Enoxaparin (Clexane) 40 mg OD' },
                { range: '50â€“69', normal: 'S/C Enoxaparin (Clexane) 60 mg BD<br><br>Alternative option: S/C Fondaparinux (Arixtra) 2.5 mg OD', renal: 'S/C Enoxaparin (Clexane) 60 mg OD' },
                { range: '70â€“99', normal: 'S/C Enoxaparin (Clexane) 80 mg BD<br><br>Alternative option: S/C Fondaparinux (Arixtra) 2.5 mg OD', renal: 'S/C Enoxaparin (Clexane) 80 mg OD' },
                { range: '100â€“120', normal: 'S/C Enoxaparin (Clexane) 100â€“120 mg BD<br><br>Alternative option: S/C Fondaparinux (Arixtra) 2.5 mg OD', renal: 'S/C Enoxaparin (Clexane) 80â€“120 mg OD' },
                { range: 'BMI â‰¥40 kg/mÂ²', normal: 'S/C Enoxaparin (Clexane) 0.75 mg/kg BD (up to 160 mg BD)<br><br>Alternative option: S/C Fondaparinux (Arixtra) 2.5 mg OD', renal: 'S/C Enoxaparin (Clexane) 0.75 mg/kg OD (up to 160 mg OD)' }
            ]
        }
    };
    
    function updateEnoxaparinUI() {
        const indication = document.getElementById('enox-indication').value;
        const bw = parseFloat(document.getElementById('enox-bw').value);
        const weightRangeFootnote = document.getElementById('enox-weight-range-footnote');
        const treatmentFootnote = document.getElementById('enox-treatment-footnote');
        const outputDiv = document.getElementById('enoxaparin-output');
        const tableBody = document.getElementById('enoxaparin-table-body');

        // Reset footnotes and output
        treatmentFootnote.style.display = 'none';
        weightRangeFootnote.innerHTML = '';
        outputDiv.style.display = 'none';
        tableBody.innerHTML = '';

        if (!indication) {
            return;
        }

        const data = enoxDoseData[indication];

        // Update treatment footnote if applicable
        if (data.footnote) {
            treatmentFootnote.innerText = data.footnote;
            treatmentFootnote.style.display = 'block';
        }

        // Update weight range footnote
        if (indication === 'pregnant-prophylaxis') {
            weightRangeFootnote.innerText = 'Weight range: <50 kg, 50-90 kg, 91-130 kg, 131-170 kg, >170 kg';
        } else {
            weightRangeFootnote.innerHTML = `Weight range: &lt;40 kg, 50-69 kg, 70-99 kg, 100-120 kg, &gt;120 kg or <a href="#" onclick="showPage('page3')">BMI &ge; 40 kg/mÂ²</a>`;
        }
        
        // Show output table if BW is entered
        if (isNaN(bw)) {
            return;
        }

        outputDiv.style.display = 'block';
        document.getElementById('enox-bw-display').innerText = bw;

        let foundMatch = false;
        
        // Populate the table rows
        data.weightRanges.forEach(rangeData => {
            const row = document.createElement('tr');
            let isMatch = false;

            // Simple logic for matching weight range
            if (rangeData.range.includes('<')) {
                const limit = parseFloat(rangeData.range.replace('<', ''));
                if (bw < limit) isMatch = true;
            } else if (rangeData.range.includes('>')) {
                const limit = parseFloat(rangeData.range.replace('>', ''));
                if (bw > limit) isMatch = true;
            } else if (rangeData.range.includes('â€“')) {
                const [min, max] = rangeData.range.split('â€“').map(s => parseFloat(s));
                if (bw >= min && bw <= max) isMatch = true;
            } else if (rangeData.range.includes('â‰¥')) {
                const limit = parseFloat(rangeData.range.replace('â‰¥', ''));
                if (bw >= limit) isMatch = true;
            } else { // Case for BMI â‰¥40 kg/mÂ²
                // We're just checking if the indication is a treatment and showing the row for now.
                // A true BMI calculation would be more complex and is outside the scope of this simplified JS.
                if (rangeData.range.includes('BMI')) {
                    if (indication === 'dvt-pe-treatment' || indication === 'acs-treatment') {
                         isMatch = true;
                    }
                }
            }

            row.innerHTML = `
                <td>${rangeData.range} kg</td>
                <td>${rangeData.normal}</td>
                <td>${rangeData.renal}</td>
            `;

            if (isMatch && !foundMatch) {
                row.querySelectorAll('td').forEach(cell => {
                    cell.classList.add('highlight');
                    cell.style.color = 'var(--maroon)';
                    cell.style.fontWeight = 'bold';
                });
                foundMatch = true;
            }
            tableBody.appendChild(row);
        });
    }

    const vasoData = {
        'noradrenaline': { strength: 4, ml: 4, label: 'Noradrenaline (NA)' },
        'dopamine': { strength: 200, ml: 5, label: 'Dopamine' },
        'dobutamine': { strength: 250, ml: 20, label: 'Dobutamine' },
        'adrenaline': { strength: 1, ml: 1, label: 'Adrenaline (Epinephrine)' }
    };
    
    function updateVasoUI() {
        const drug = document.getElementById('vaso-drug').value;
        const footnote = document.getElementById('vaso-strength-footnote');
        const outputs = document.getElementById('vaso-outputs');

        if (!drug) {
            footnote.innerText = '';
            outputs.style.display = 'none';
            return;
        }

        const data = vasoData[drug];
        footnote.innerText = `Drug strength per ampoule/vial: ${data.strength} mg per ${data.ml} mL ampoule/vial`;
        calculateVasoSupply();
    }
    
    function calculateVasoSupply() {
        const drug = document.getElementById('vaso-drug').value;
        const rate = parseFloat(document.getElementById('vaso-rate').value);
        const strengthPrep = document.getElementById('vaso-strength-prep').value;
        const duration = parseFloat(document.getElementById('vaso-duration').value);
        const diluent = parseFloat(document.getElementById('vaso-diluent').value);
        
        const outputs = document.getElementById('vaso-outputs');
        if (isNaN(rate) || !drug || !strengthPrep || isNaN(duration) || isNaN(diluent)) {
            outputs.style.display = 'none';
            return;
        }
        outputs.style.display = 'block';
        
        const drugData = vasoData[drug];
        const strengthMultiplier = strengthPrep === 'single' ? 1 : 2;

        // Preparation
        const prepStrengthMg = drugData.strength * strengthMultiplier;
        const prepOutput = `${drugData.label} ${prepStrengthMg} mg in ${diluent} mL per preparation`;

        // Quantity
        const quantity = Math.ceil((rate * duration * strengthMultiplier) / diluent);

        // Display outputs
        document.getElementById('vaso-summary').innerText = 
            `Drug: ${drugData.label}, Rate: ${rate} mL/hr, Duration: ${duration} hrs, Strength: ${strengthPrep.toUpperCase()}, Diluent: ${diluent} mL`;
        document.getElementById('vaso-preparation').innerText = prepOutput;
        document.getElementById('vaso-quantity').innerText = `${quantity} ampoule(s) or vial(s) per day`;
    }

    // Initial state setup
    document.addEventListener('DOMContentLoaded', () => {
        showPage('page1');
    });

</script>

</body>
</html>
